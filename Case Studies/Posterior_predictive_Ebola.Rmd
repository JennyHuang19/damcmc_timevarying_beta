---
title: "Posterior_predictive_Ebola"
author: "Jenny Yijian Huang"
date: '2022-06-24'
output: html_document
---


# Simulate 1 draw from the predictive distribution

```{r}
# average of beta vector (one posterior sample)
mean(ebola_6$beta_lst[[19]])
```


```{r}
sim19_ebola_ppc <- sim_posterior_predictive(S0 = 291823, I0 = 1e1, t_end = 12,
  theta = list(beta = ebola_6$beta_lst[[19]], gamma = 0.8, lambda = 1, shape = 1),
  change_day = seq(1,11,1),
  iota_dist = "exponential", # "weibull"
  gener = FALSE, b = 1/2,
  E0 = 0, type = "SIR")
```

```{r}
sim19_ebola_ppc$beta_MLE
sim19_ebola_ppc$final_size
```


# Output only the $t and $I and $SS (for each simulated trajectory in the posterior predictive check).

```{r}
# Below, we visualize the I(t) compartment over time.
plot(x = sim19_ebola_ppc$t[1:400], y = sim19_ebola_ppc$I[1:400], type="l", col = "blue", lwd=0.5, main="Epidemic Trajectory",
   xlab="Time", ylab="I(t)")
```

# A list where each beta_t represents that value for the week.
```{r}
ebola_6$beta_lst[[19000]]
```

```{r}
#
# Initialize an empty list to store the posterior predictive trajectories and the final_size of each trajectory.
pred_trajectories <- vector("list", length(ebola_6$beta_lst[1:21]))
final_sizes <- vector(length = length(ebola_6$beta_lst[1:21]))

# Draw 10 samples from P(y_hat | theta).
for(i in 1:length(ebola_6$beta_lst[1:22])){
  
  startTime <- Sys.time()
  
  pred_trajectories[[i]] <- sim_posterior_predictive(S0 = 291823, I0 = 1e1, t_end = 50,
  theta = list(beta = ebola_6$beta_lst[[i+19900]], gamma = 0.8, lambda = 1, shape = 1),
  change_day = seq(1,11,1),
  iota_dist = "exponential",
  gener = FALSE, b = 1/2,
  E0 = 0, type = "SIR")
  
  final_sizes[i] <- pred_trajectories[[i]]$final_size
  
  endTime <- Sys.time()
  
  # prints recorded time
  print(endTime - startTime)
}

# pred_trajectories[1:10]
```


# Histogram and density plot of the final sizes.
```{r}
# Histogram
hist(final_sizes, breaks = 20, col = "blue")
abline(v = sum(Y_ebola$T_k), col="black", lwd=4, lty=2) # from Ebola_cases.Rmd

# Kernel Density Plot
# d <- density(final_sizes) # returns the density data
# plot(d) # plots the results
```

# predictive I(t) Numbers Over Time. 
```{r}
# But we don't actually have the I(t) value to look at in Ebola
plot(x = pred_trajectories[[1]]$t[1:4000], y = pred_trajectories[[1]]$I[1:4000], type="l", col = "blue", lwd=0.5, main="Posterior Predictive Epidemic Trajectories",
   xlab="Time", ylab="I(t)")
for(i in 1:10){
  lines(pred_trajectories[[i]]$t[1:4000],pred_trajectories[[i]]$I[1:4000],col="blue")
}
```
# Do we see a bias upwards of Ebola cases? if so, why? search what to do next.

Why is it that we see a long right tail in simulated epidemic sizes?
